## Pre-Rendering

## Как работает React? 
Всегда отправляет пустой HTML-документ, в котором есть
корневой div-element. Затем пользователь загружает java-script code, который в
свою очередь загружает данные для генерации HTML-структуры страницы.

## Как работает NEXT.js? 
Предварительно формирует HTML-страницу со всей структурой
и отдаёт её пользователю.

#### Next.js имеет две формы предварительно рендеринга страницы (SSR):

- <span style="color: red">Static Server Generation (SSG).</span> 
  Все страницы предварительно генерируются во время сборки.
  Этот подход используется по умолчанию.

  Код внутри этой функции никогда не будет видет клиенту. В говотой сборке его
  просто не будет.

  Этот подход можно инициализировать вручную, добавив в файл страницы, важно, не
  компонента, а именно страницы, данную функцию. Она должна быть идентична
  описанной ниже.
  
  Функция возвращает всегда возвращает объект среди которого есть след. свойства:

  - props: То что попадает в компонент страницы
  - revalidate: Позволяет задействовать ISR, если данные изменяются, позволяет
    указать промежуток времени (в сек.), после которого страницы будет собираться заново.
  - notFound: принимает булиан. Если true, возращает страницу ошибки.
  - redirect: объект, который позволяет настроить редирект на другие маршруты.

  Процесс таков, сперва выполняется данная функция, которая подготавливает, объект
  "props" для нашей страницы, а затем уже формируется сама страница. 

  <span style="color: blue">getStaticProps</span>

  <code>
  export async function getStaticProps(context) { 
    return {
      props?: {},
      revalidate?: number,
      notFound?: boolean,
      redirect?: {}
    }
  </code>

  "context" parametr it's object, that have next keys:
  1. "params" - если страница использует динамический раут, тут будут находиться
     динамические кусочки данных.
  2. "preview" - буль. Правдивый, если страница находится в Preview Mode и ложный в
     противополжном случае.
  3. "preview data" - включает preview data установленную в setPreviewData.
  4. "locale" - включает активную локаль, если та установлена.
  5. "locales" - включает все поддерживаемые локали, если те установлены.
  6. "defaultlocale" - включает настроенный локали по умолчанию, если те установлены.


  Сам объект "props" внутри компонента страницы, в исходном коде просмотреть можно.
  Не передавать конфиденциальную информацию!

  https://nextjs.org/docs/basic-features/data-fetching/get-static-props

  <span style="color: blue">getStaticPath</span>
  Функция, которая возвращает возможные динамические пути.
  Функция обязательна, если мы используем SSG в динамическом рауте.
  Так как Next.js не может знать заранее сколько динамических страниц 
  ему собрать.

  Возвращает объект, который имеет два свойства:

  - paths: Массив, который содержит объект с вложенным объектом "params",
    который в свою очередь содержит пару ключ-значение (идентификатор - значение).

  - fallback: показывать страницу ошибки в случае перехода по несуществующему пути или нет.
    Когда это может быть полезно?
    Когда у нас очень-очень много страниц, и какие-то из них не очень посещаемые.
    Для оптимизации мы можем предварительно сгенирировать только определённую часть страниц, не все,
    в то же время, менее популярные страницы не будут сгенерированы заранее, они будет генерироваться
    в момент поступления запроса на сервер.

    Значением также может быть строка "blocking", тогда Next - не покажет страницу до тех пор,
    пока данные не будут получены.

    Удобно комбинировать значения fallback: true | "blocking" и 
    в getStaticProps, если единица чего-то не найдена вернуть {notFound: true};

    Теперь мы адекватно обрабатываем все возможные варианты.
    Если есть данные для конкретного товара, но не указана в статике, мы сформируем страницу при запросе.
    Если нет, вернём страницу ошибки.

  <code>
  export async function getStaticPaths() { 
    return {
      paths: [{params: {someKey: value}}],
      fallback?: boolean | "blocking"
    }
  </code>

<strong>Когда следует использовать данный подход?</strong>

- Необходимые данные для рендера страницы, доступны во время сборки проекта.
  До пользовательского запроса.

- Данные поступают от безголовой CMS

- Страница должна быть предварительно сгенирирована для SEO

---

- <span style="color: yellow">Incremental Static Regeneration (ISR).</span>
  Это дополнение к первому методу работы с SSR.
  Позволяет создавать и обновлять статические страницы, после процесса сборки.
  Для того чтобы воспользоваться преимуществами ISR.
  Необходимо добавить в возвращаемый объект из функции "getStaticProps",
  новое свойство "revalidate", которое принимает число (кол-во секунд).
  После его установки, страница будет автоматически сгенерирована заново,
  когда поступает новый запрос, однако не чаще одного раза в указанное 
  кол-во времени в свойстве "revalidate".

  <span style="color: red">
  Важно! В режиме разработчика, страница будет пересобираться
  при каждом запросе. Так что этот параметр действительно работает, только в 
  build-версии проекта.
  </span>

---

- <span style="color:green">Server Side Rendering (SSR).</span> 
  Страницы создаются после развертывания
  веб-приложения, когда запрос достигает сервера.
  Это означает, что на каждый запрос клиент --> сервер, сначала создаётся
  и наполняется страница, а после возвращается клиенту.
  Помимо этого мы получаем доступ к объектам запроса (request) и ответа (response).

  <span style="color: blue">getServerSideProps</span>
  Функция, которая возвращает пропсы для страницы при каждом поступающем запросе.

    <code>
  export async function getServerSideProps(context) { 
    return {
      props?: {},
      notFound?: {},
      redirect?: {} 
    }
  </code>

  "context" parametr it's object, that have next keys:
  1. "params" - если страница использует динамический раут, тут будут находиться
     динамические кусочки данных.
  2. "req" - объект запроса
  3. "res" - объект ответа
  4. "preview" - буль. Правдивый, если страница находится в Preview Mode и ложный в
     противополжном случае.
  5. "preview data" - включает preview data установленную в setPreviewData.
  6. "resolvedUrl" - нормализированная версия запрашиваемого URL-адреса. 
  7. "locale" - включает активную локаль, если та установлена.
  8. "locales" - включает все поддерживаемые локали, если те установлены.
  9. "defaultlocale" - включает настроенный локали по умолчанию, если те установлены.

### В тоже время мы все также можем использовать Client Side Rendering (CSR).

Этот подход можем быть лучшим решением в случаях когда:

- Данные обновляются слишком часто (например биржевые котировки).
- Это очень специфические данные (например последние покупки пользователя)
- Нам в принципе не нужно для этой страницы ни SEO, ни пре-рендеринг.